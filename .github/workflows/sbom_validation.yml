name: SBOM Validation

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  sbom:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Générer SBOM CycloneDX
        run: |
          cyclonedx-bom -o docs/sbom-cyclonedx.json
      - name: Générer SBOM SPDX
        run: |
          spdx-sbom-generator -o docs/sbom-spdx.json
      - name: Valider SBOM (Trivy)
        run: |
          trivy sbom docs/sbom-cyclonedx.json --format json --output docs/sbom-trivy-report.json
      - name: Valider SBOM (Snyk)
        run: |
          snyk test --file=docs/sbom-cyclonedx.json --json > docs/sbom-snyk-report.json || true
      - name: Upload SBOM & reports
        uses: actions/upload-artifact@v4
        with:
          name: sbom-validation
          path: docs/sbom-cyclonedx.json
